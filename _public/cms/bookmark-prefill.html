<!DOCTYPE html>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Bookmark Prefill</title>
<link rel="manifest" href="/cms/bookmark-prefill-manifest.json">
<style>
  label {
    display: flex;
    flex-direction: column;
  }

  input {
    padding: 0.5rem;
  }

  a {
    display: block;
    margin-top: 1rem;
  }
</style>

<h1>Bookmark Prefill</h1>

<div>
  <label>
    <div>Title:</div>
    <input type="text" />
  </label>
</div>
<br />
<div>
  <label>
    <div>Url:</div>
    <input type="url" />
  </label>
</div>

<script>
  const titleInput = document.querySelector('input[type="text"]')
  const urlInput = document.querySelector('input[type="url"]')
  const queryString = location.search.replace('?', '')
  const pairs = queryString
    .split('&')
      .map(part => part
        .split('=')
      )
  const titlePair = pairs.find(([key]) => key === 'title')
  const urlPair = pairs.find(([key]) => key === 'text')

  titlePair && titlePair[1] && (titleInput.value = decodeURIComponent(titlePair[1]))
  urlPair && urlPair[1] && (urlInput.value = decodeURIComponent(urlPair[1]))

  const aElement = document.createElement('a')
  aElement.href = `/cms/#/collections/bookmarks/new?title=${titlePair[1]}&url=${urlPair[1]}`
  aElement.innerText = 'Save as bookmark'
  document.body.appendChild(aElement)
</script>

<script type="module">
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js');
    });
  }
</script>
